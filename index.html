<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DERMATO — Your AI Skin Health Partner</title>
  <meta name="description" content="DERMATO — premium demo UI for an AI dermatology assistant. Frontend only, no medical advice."/>
  <meta name="theme-color" content="#004d61">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ================= Brand Tokens ================= */
    :root{
      --teal:#009688;           /* primary */
      --navy:#004d61;           /* contrast */
      --light-green:#8BC34A;    /* accent */
      --bg: #f8fafb;
      --text:#0e2a32;
      --muted:#6d8590;
      --white:#ffffff;
      --border: rgba(0,0,0,.08);
      --card: #ffffff;
      --shadow-lg: 0 24px 60px rgba(0,0,0,.12);
      --shadow-md: 0 14px 32px rgba(0,0,0,.10);
      --radius:16px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{width:min(1180px,92%);margin-inline:auto}

    /* ================= Hero ================= */
    .hero{
      position:relative;
      background: radial-gradient(1000px 600px at 20% -10%, rgba(139,195,74,.20), transparent 50%),
                 linear-gradient(135deg, var(--teal) 0%, var(--navy) 70%);
      color: var(--white);
      overflow:hidden;
    }
    .hero::after{ /* soft grid glow */
      content:""; position:absolute; inset:0; pointer-events:none;
      background: radial-gradient(800px 400px at 85% 20%, rgba(255,255,255,.10), transparent 60%);
    }
    .nav{position:sticky;top:0;z-index:40;background:rgba(0,0,0,.25);backdrop-filter:blur(10px)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;min-height:72px}
    .brand{display:flex;align-items:center;gap:.8rem}
    .wordmark{font-family:Poppins,system-ui; font-weight:800; letter-spacing:.06em; text-transform:uppercase}
    .wordmark b{display:inline-block; background:linear-gradient(180deg,#fff,#e6fff4); -webkit-background-clip:text; background-clip:text; color:transparent}

    .logo{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:12px;
          background:linear-gradient(135deg, #e6fff4, #b2f1c9);
          box-shadow: inset 0 0 0 2px rgba(255,255,255,.7), 0 6px 16px rgba(0,0,0,.2)}
    .logo svg{width:26px;height:26px}

    .nav-menu{display:flex;gap:.4rem}
    .nav-menu a{color:#e8f7ff;padding:.55rem .9rem;border-radius:999px;border:1px solid transparent}
    .nav-menu a:hover{border-color:rgba(255,255,255,.35);background:rgba(255,255,255,.12)}
    .nav-toggle{display:none;background:transparent;border:0}
    .nav-toggle span{display:block;width:24px;height:2px;background:#fff;margin:5px 0;border-radius:2px}

    .hero-inner{display:grid;grid-template-columns:1.15fr .85fr;gap:2.2rem;align-items:center;padding:64px 0 40px}
    .headline{font-family:Poppins,system-ui; font-weight:800; font-size:clamp(2.2rem,4vw,3.6rem); margin:0 0 .4rem}
    .subhead{color:#e7f7f3;margin:.25rem 0 1.2rem}

    .tag-rotator{min-height:2.1em;display:inline-block;position:relative}
    .tag-rotator span{position:absolute;inset:0;opacity:0;transform:translateY(6px);transition:opacity .6s ease, transform .6s ease}
    .tag-rotator span.active{opacity:1;transform:translateY(0)}

    .cta{display:flex;gap:.8rem;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.55rem;padding:.9rem 1.15rem;border-radius:12px;border:1px solid rgba(255,255,255,.2);cursor:pointer;transition: transform .15s ease, box-shadow .15s ease, filter .15s ease}
    .btn-primary{background:#eafff2;color:#0b3b3f;border-color:transparent;box-shadow:0 10px 24px rgba(0,0,0,.18)}
    .btn-primary:hover{transform:translateY(-1px); box-shadow:0 14px 30px rgba(0,0,0,.22)}
    .btn-ghost{background:rgba(255,255,255,.12); color:#fff}
    .btn-ghost:hover{filter:brightness(1.05)}

    /* ================= Sections & Cards ================= */
    .section{padding:54px 0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:1.1rem}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.1rem}
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:1.1rem}

    /* Slide-up animation on scroll */
    .reveal{opacity:0; transform: translateY(12px); transition: opacity .6s ease, transform .6s ease}
    .reveal.show{opacity:1; transform: translateY(0)}

    /* ================= Chat & Tools ================= */
    .tools{margin-top:10px}
    .chip{display:inline-flex;align-items:center;gap:.4rem;padding:.5rem .75rem;border-radius:999px;border:1px solid #d5e7ea;background:#f2fbfc;color:#0a3c43;cursor:pointer;user-select:none}
    .chip.active{background:#e6fff4;border-color:#b2f1c9}

    .inputs{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem}
    .inputs input[type="number"], .inputs input[type="text"]{padding:.75rem .85rem;border-radius:10px;border:1px solid #d6e6ea;background:#fbfeff;min-width:120px}

    .chat{display:flex;flex-direction:column;gap:12px}
    .chat-window{height:420px;overflow:auto;padding:1rem;background:#fbfffe;border:1px solid #e3f2f4;border-radius:12px}
    .msg{display:flex;margin:.25rem 0}
    .bubble{padding:.7rem .9rem;border-radius:12px;max-width:78%;background:#f4fbff;border:1px solid #d9ecee}
    .msg.user{justify-content:flex-end}
    .msg.user .bubble{background:#eafff2;border-color:#bdeccf}

    .meter{height:10px;border-radius:999px;background:#e5f3f5;position:relative;overflow:hidden}
    .meter>span{display:block;height:100%;width:0%;background:linear-gradient(90deg, var(--light-green), #b2f1c9)}

    .note{color:var(--muted);margin:0 .2rem}

    /* ================= Footer ================= */
    footer{background:#f1fbff;border-top:1px solid #dbeef2}
    .footer-inner{display:flex;flex-direction:column;gap:.25rem;align-items:center;text-align:center;padding:18px 0;color:#2a515a}

    /* ================= Responsive ================= */
    @media(max-width: 980px){.hero-inner{grid-template-columns:1fr}}
    @media(max-width: 760px){
      .nav-toggle{display:block}
      .nav-menu{position:absolute;top:72px;left:0;right:0;display:none;flex-direction:column;background:rgba(0,0,0,.6);backdrop-filter:blur(12px)}
      .nav-menu.open{display:flex}
      .nav-menu a{padding:1rem 1.1rem;border-bottom:1px solid rgba(255,255,255,.2)}
      .grid-3,.grid-2{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header class="hero" id="home">
    <nav class="nav">
      <div class="container nav-inner">
        <a class="brand" href="#home" aria-label="DERMATO Home">
          <span class="logo" aria-hidden="true">
            <!-- D with medical cross -->
            <svg viewBox="0 0 64 64" role="img" aria-hidden="true">
              <path d="M18 14h14c12 0 20 8 20 18s-8 18-20 18H18z" fill="#004d61"/>
              <rect x="26" y="24" width="12" height="16" rx="2" fill="#eafff2"/>
              <rect x="22" y="28" width="20" height="8" rx="2" fill="#eafff2"/>
            </svg>
          </span>
          <span class="wordmark"><b>DERMATO</b></span>
        </a>
        <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu" aria-label="Toggle navigation">
          <span></span><span></span><span></span>
        </button>
        <div id="nav-menu" class="nav-menu" aria-label="Primary">
          <a href="#home" class="active">Home</a>
          <a href="#chatbot">Chatbot</a>
          <a href="#about">About</a>
        </div>
      </div>
    </nav>

    <div class="container hero-inner">
      <div class="copy reveal">
        <h1 class="headline">Dermato — Your AI Skin Health Partner</h1>
        <p class="subhead" aria-live="polite">
          <span class="tag-rotator" id="tagRotator"><span class="active">Smart Skin Care, Backed by AI</span></span>
        </p>
        <div class="cta">
          <a class="btn btn-primary" href="#chatbot">Start Chat</a>
          <a class="btn btn-ghost" href="#chatbot">Try Scan</a>
        </div>
      </div>
      <div class="card reveal">
        <h3 style="margin:.2rem 0 .6rem;font-family:Poppins">What you can try</h3>
        <ul style="margin:.2rem 0 1rem; padding-left:1.1rem">
          <li>Upload a skin image (local preview only)</li>
          <li>Select symptoms, duration & severity</li>
          <li>Run a simulated AI scan and get care tips</li>
          <li>Chat freely — the assistant replies to anything</li>
        </ul>
        <a class="btn" href="#chatbot">Open Tools</a>
      </div>
    </div>
  </header>

  <section class="section">
    <div class="container grid-3">
      <article class="card reveal">
        <h3 style="font-family:Poppins;margin:.1rem 0 .4rem">Simple Upload</h3>
        <p>Client‑side compression & preview to keep it smooth. No data leaves your browser.</p>
      </article>
      <article class="card reveal">
        <h3 style="font-family:Poppins;margin:.1rem 0 .4rem">Guided Questions</h3>
        <p>Toggle common symptoms, add duration/severity, and get clear next‑step suggestions.</p>
      </article>
      <article class="card reveal">
        <h3 style="font-family:Poppins;margin:.1rem 0 .4rem">Clinic Finder</h3>
        <p>With permission, opens nearby dermatologists in Google Maps based on your location.</p>
      </article>
    </div>
  </section>

  <section id="chatbot" class="section">
    <div class="container grid-2">
      <!-- Tools / Inputs -->
      <div class="card reveal">
        <h2 style="font-family:Poppins;margin:.1rem 0 .6rem">Tools</h2>
        <div class="tools">
          <div class="upload-row" style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center">
            <input id="file" type="file" accept="image/*" />
            <button class="btn" id="clearImg" type="button">Clear image</button>
            <span id="imgInfo" aria-live="polite"></span>
          </div>
          <div class="preview" id="preview" hidden style="display:flex;gap:.8rem;align-items:center;margin-top:.6rem">
            <img id="thumb" alt="Uploaded preview" style="width:92px;height:92px;object-fit:cover;border-radius:12px;border:1px solid #dbeef2"/>
            <div>
              <div class="meter" aria-hidden="true"><span id="qMeter"></span></div>
              <small class="note">Preview quality estimate</small>
            </div>
          </div>

          <div class="symptoms" style="margin-top:.8rem">
            <div style="display:flex;gap:.5rem;flex-wrap:wrap">
              <span class="chip" data-s="redness">Redness</span>
              <span class="chip" data-s="itching">Itching</span>
              <span class="chip" data-s="pain">Pain</span>
              <span class="chip" data-s="dryness">Dryness</span>
              <span class="chip" data-s="pimples">Pimples</span>
              <span class="chip" data-s="rash">Rash</span>
              <span class="chip" data-s="scales">Scales</span>
              <span class="chip" data-s="oozing">Oozing</span>
            </div>
            <div class="inputs">
              <label>Duration (days): <input id="dur" type="number" min="0" step="1" value="1"></label>
              <label>Severity (1–10): <input id="sev" type="number" min="1" max="10" step="1" value="3"></label>
              <button id="scan" class="btn" type="button" title="Simulated AI scan">Scan Image</button>
              <button id="findClinics" class="btn" type="button">Find nearby clinics</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat -->
      <div class="card reveal">
        <h2 style="font-family:Poppins;margin:.1rem 0 .6rem">Assistant</h2>
        <div class="chat">
          <div class="chat-window" id="chat" role="log" aria-live="polite">
            <div class="msg bot"><div class="bubble">Hi! I’m Dermato. Ask me anything about skin care or health. You can also upload a photo and press <b>Scan Image</b> for a simulated analysis. This is a demo — not medical advice.</div></div>
          </div>
          <form class="inputs" onsubmit="return false" aria-label="Chat input">
            <input id="text" type="text" placeholder="Type anything…"/>
            <button class="btn btn-primary" id="send" type="button">Send</button>
            <button class="btn" id="clearChat" type="button">Clear chat</button>
          </form>
          <p class="note">Tip: Try asking about acne routines, sunscreen choices, or when to see a dermatologist.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="about" class="section">
    <div class="container">
      <div class="card reveal">
        <h2 style="font-family:Poppins;margin:.1rem 0 .6rem">About</h2>
        <p>DERMATO is a front‑end demo that simulates how an AI dermatology assistant could work. It includes a heuristic chatbot and a mock image scan to demonstrate user flow and UI. No data leaves your browser unless you click <em>Find nearby clinics</em> to open Google Maps.</p>
      </div>
    </div>
  </section>

  <footer>
    <div class="container footer-inner">
      <p>© <span id="year"></span> DERMATO</p>
      <p><small>Teal • Navy • Light Green — Frontend demo only</small></p>
    </div>
  </footer>

  <script>
    // ========== Helpers ==========
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    // Navbar toggle
    const toggle = $('.nav-toggle');
    const menu = $('#nav-menu');
    if (toggle && menu){
      toggle.addEventListener('click', () => {
        const open = menu.classList.toggle('open');
        toggle.setAttribute('aria-expanded', String(open));
      });
    }

    // Footer year
    $('#year').textContent = new Date().getFullYear();

    // Reveal on scroll
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target);} })
    },{threshold:.12});
    $$('.reveal').forEach(el=>io.observe(el));

    // Active nav link on scroll
    const links = $$('.nav-menu a');
    function setActiveLink(){
      const fromTop = window.scrollY + 90;
      links.forEach(link => {
        const sec = document.querySelector(link.getAttribute('href'));
        if (!sec) return;
        if (sec.offsetTop <= fromTop && sec.offsetTop + sec.offsetHeight > fromTop){
          link.classList.add('active');
        } else { link.classList.remove('active'); }
      });
    }
    window.addEventListener('scroll', setActiveLink);
    setActiveLink();

    // ========== Tagline Rotator ==========
    const taglines = [
      'Smart Skin Care, Backed by AI',
      'From Symptoms to Solutions — Instantly',
      'Your Skin, Our AI Expertise',
      'Find Answers. Feel Better. Faster.',
      'AI‑Powered Dermatology, Anytime, Anywhere',
      'Healthy Skin Starts with Dermato',
      'Scan. Detect. Treat.',
      'Your Skin Deserves AI Precision',
      'Instant Dermatology, Zero Waiting Rooms',
      'Confidence in Every Scan',
      'Science Meets Skin Care',
      'Diagnose. Understand. Heal.'
    ];
    const rotHost = $('#tagRotator');
    function renderRotator(lines){
      rotHost.innerHTML = '';
      lines.forEach((t, i) => {
        const span = document.createElement('span');
        span.textContent = t;
        if (i === 0) span.classList.add('active');
        rotHost.appendChild(span);
      });
    }
    renderRotator(taglines);
    let idx = 0;
    setInterval(() => {
      const children = rotHost.querySelectorAll('span');
      if (!children.length) return;
      children[idx].classList.remove('active');
      idx = (idx + 1) % children.length;
      children[idx].classList.add('active');
    }, 2600);

    // ========== Chat ==========
    const chat = $('#chat');
    function addMsg(role, html){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
      const b = document.createElement('div');
      b.className = 'bubble';
      b.innerHTML = html;
      wrap.appendChild(b);
      chat.appendChild(wrap);
      chat.scrollTop = chat.scrollHeight;
      saveHistory();
    }
    function saveHistory(){ localStorage.setItem('dermato_history', chat.innerHTML); }
    function loadHistory(){ const h = localStorage.getItem('dermato_history'); if (h) chat.innerHTML = h; }
    loadHistory();

    // Simple “smart” reply generator (heuristic, offline)
    function smartReply(input, ctx={}){
      const txt = String(input||'').trim();
      if(!txt) return 'Could you share a bit more? For example: symptoms, duration, products used.';
      const lower = txt.toLowerCase();
      const isQ = /\?|^how\b|^what\b|^why\b|^when\b|^should\b|^can\b/.test(lower);
      const emo = /(worried|scared|anxious|embarrassed|pain|hurts|itch|itching|burn)/.test(lower);
      const topics = [
        {k:/acne|pimple|zit|blackhead|whitehead/, t:'acne'},
        {k:/eczema|atopic|dermatitis|dry/, t:'eczema'},
        {k:/psoriasis|plaque|scales?/, t:'psoriasis'},
        {k:/fung|ringworm|tinea|yeast/, t:'fungal'},
        {k:/allerg|hive|urticaria|rash/, t:'allergy'},
        {k:/mole|nevus|spot|melanoma|cancer/, t:'lesion-check'},
        {k:/sunscreen|spf|sun/, t:'sunscreen'},
      ];
      const hit = topics.find(o=>o.k.test(lower));

      const opening = emo
        ? 'I hear you — skin issues can feel stressful. You’re not alone and we can walk through it step by step.'
        : 'Got it. Let’s break this down clearly.';

      const general = 'A quick checklist that helps most people:\n<ul>\n<li>Cleanse gently (no harsh scrubs).</li>\n<li>Moisturize with a fragrance‑free product.</li>\n<li>Daily sunscreen SPF 30+ (broad‑spectrum).</li>\n<li>Avoid picking/squeezing; keep hands off the area.</li>\n</ul>';

      let specific = '';
      switch(hit?.t){
        case 'acne': specific = '<b>For acne‑prone skin:</b> try benzoyl peroxide 2.5% or salicylic acid 0.5–1% spot treatment. If persistent, consider adapalene (OTC) nightly, moisturize after.'; break;
        case 'eczema': specific = '<b>For dry/eczema‑like flares:</b> use a ceramide‑rich moisturizer twice daily; short, lukewarm showers; consider 1% hydrocortisone thin layer for up to 7 days if itchy (label‑directed).'; break;
        case 'psoriasis': specific = '<b>For scaly plaques:</b> gentle keratolytics (urea/lactic acid) and petrolatum‑based moisturizers; discuss topical steroids or vitamin D analogs with a clinician.'; break;
        case 'fungal': specific = '<b>For likely fungal issues:</b> keep area dry; consider clotrimazole 1% twice daily for 2–4 weeks; wash fabrics hot; avoid sharing towels.'; break;
        case 'allergy': specific = '<b>For allergy‑type rashes/hives:</b> identify and stop new products; cool compresses; consider non‑drowsy antihistamine (label‑directed).'; break;
        case 'lesion-check': specific = '<b>For changing moles/spots:</b> watch for ABCDE (Asymmetry, Border, Color, Diameter, Evolving). Any fast change, bleeding, or asymmetry — book a dermatologist promptly.'; break;
        case 'sunscreen': specific = '<b>Sunscreen tips:</b> SPF 30+ broad‑spectrum, 2‑finger rule for face/neck, reapply every 2 hours outdoors; look for non‑comedogenic if acne‑prone.'; break;
        default: specific = '<b>Context noted:</b> I can suggest care basics and when to seek help.';
      }

      const close = 'If symptoms are severe, spreading, or accompanied by fever, see a clinician. This chat is a demo and not medical advice.';

      const answer = `${opening}${isQ? ' Here’s what may help:' : ''}<br>${specific}<br>${general}<em>${close}</em>`;
      return answer;
    }

    $('#send').addEventListener('click', () => {
      const t = $('#text');
      const val = t.value.trim();
      if (!val) return;
      addMsg('user', val.replace(/</g,'&lt;'));
      // Simulate thinking
      const thinking = document.createElement('div');
      thinking.className='msg bot';
      thinking.innerHTML = '<div class="bubble">Thinking…</div>';
      chat.appendChild(thinking); chat.scrollTop = chat.scrollHeight;
      setTimeout(() => {
        thinking.remove();
        const reply = smartReply(val);
        addMsg('bot', reply);
      }, 500);
      t.value='';
    });

    $('#clearChat').addEventListener('click', () => {
      chat.innerHTML = '<div class="msg bot"><div class="bubble">History cleared. Ask me anything to begin.</div></div>';
      saveHistory();
    });

    // ========== Image upload + preview + quality bar ==========
    const fileInput = $('#file');
    const thumb = $('#thumb');
    const preview = $('#preview');
    const info = $('#imgInfo');
    const qMeter = $('#qMeter');

    function humanSize(bytes){
      const units = ['B','KB','MB','GB']; let i=0, n=bytes;
      while(n>=1024 && i<units.length-1){ n/=1024; i++; }
      return n.toFixed(1)+' '+units[i];
    }
    function estimateQuality(w,h){ // naive preview quality
      const pixels = w*h;
      const pct = Math.max(10, Math.min(100, (pixels/ (900*900))*100));
      return pct;
    }

    fileInput.addEventListener('change', async (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        const maxSide = 300;
        const scale = Math.min(1, maxSide/Math.max(img.width, img.height));
        canvas.width = Math.round(img.width*scale);
        canvas.height = Math.round(img.height*scale);
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        thumb.src = canvas.toDataURL('image/jpeg', 0.82);
        preview.hidden = false;
        info.textContent = `Selected: ${f.name} • ${humanSize(f.size)} • ${img.width}×${img.height}`;
        const q = estimateQuality(img.width, img.height);
        qMeter.style.width = q + '%';
        URL.revokeObjectURL(url);
        addMsg('user', 'Uploaded an image for analysis (preview only).');
      };
      img.src = url;
    });

    $('#clearImg').addEventListener('click', () => {
      fileInput.value = '';
      if (thumb) thumb.removeAttribute('src');
      if (preview) preview.hidden = true;
      if (info) info.textContent = '';
      addMsg('user','Cleared the image.');
    });

    // ========== Simulated AI Scan ==========
    const selected = new Set();
    $$('.chip').forEach(ch => {
      ch.addEventListener('click', () => {
        const key = ch.dataset.s;
        if (selected.has(key)){ selected.delete(key); ch.classList.remove('active'); }
        else { selected.add(key); ch.classList.add('active'); }
      });
    });

    function pickCondition(sym){
      const s = new Set(sym);
      const table = [
        {cond:'Acne Vulgaris', keys:['pimples','redness'], tips:['Use 2.5% benzoyl peroxide','Avoid pore‑clogging makeup','Non‑comedogenic moisturizer']},
        {cond:'Atopic Dermatitis (Eczema)', keys:['dryness','itching','rash'], tips:['Thick fragrance‑free moisturizer','Short lukewarm showers','Avoid known irritants']},
        {cond:'Seborrheic Dermatitis', keys:['scales','redness','itching'], tips:['Gentle cleanser','Anti‑dandruff shampoo for scalp','Moisturize barrier']},
        {cond:'Contact Dermatitis', keys:['rash','itching','redness'], tips:['Stop new product','Cool compress','Consider antihistamine (label‑directed)']},
        {cond:'Folliculitis', keys:['pimples','pain','redness'], tips:['Warm compress','Avoid shaving/irritation','Keep area clean and dry']},
        {cond:'Tinea (Fungal) Infection', keys:['scales','itching','rash'], tips:['Keep area dry','Clotrimazole 1% twice daily','Don’t share towels/clothes']},
        {cond:'Psoriasis (Plaque)', keys:['scales','redness'], tips:['Moisturize with urea/lactic acid','Sun protection','Discuss topicals with clinician']},
      ];
      // score by overlap
      let best = table[0], bestScore=-1;
      table.forEach(row=>{
        const score = row.keys.reduce((acc,k)=> acc + (s.has(k)?1:0),0);
        if (score>bestScore){ best=row; bestScore=score; }
      });
      return best;
    }

    function computeRisk(duration,severity){
      const d = Number(duration)||0; const sev = Number(severity)||1;
      if (sev>=8 || d>=10) return 'moderate';
      if (sev>=5 || d>=4) return 'low‑to‑moderate';
      return 'low';
    }

    function simulateScan(){
      const d = $('#dur').value; const sev = $('#sev').value;
      const cond = pickCondition(Array.from(selected));
      const risk = computeRisk(d,sev);
      const confidence = Math.max(62, Math.min(97, 70 + (selected.size*5) + (sev*2) - (d*1))); // playful heuristic
      const tips = cond.tips.map(t=>`<li>${t}</li>`).join('');
      const follow = risk==='moderate'
        ? 'Because your risk looks moderate, consider seeing a dermatologist, especially if spreading, painful, or with fever.'
        : 'Monitor for changes; seek a professional if symptoms worsen.';

      return `\n<b>Possible condition:</b> ${cond.cond}<br>\n<b>Confidence:</b> ~${confidence}% • <b>Estimated risk:</b> ${risk}<br>\n<b>Suggested care:</b>\n<ul>${tips}</ul>\n${follow} <br><small class="note">This is a demo and not medical advice.</small>`;
    }

    $('#scan').addEventListener('click', () => {
      addMsg('user', `Scan my inputs. Symptoms: <code>${Array.from(selected).join(', ')||'none'}</code>; duration: ${$('#dur').value}d; severity: ${$('#sev').value}/10.`);
      const thinking = document.createElement('div');
      thinking.className='msg bot';
      thinking.innerHTML = '<div class="bubble">Analyzing image… <span aria-hidden="true">▰▱▱▱</span></div>';
      chat.appendChild(thinking); chat.scrollTop = chat.scrollHeight;
      setTimeout(()=>{ thinking.querySelector('.bubble').innerHTML = 'Analyzing image… <span aria-hidden="true">▰▰▱▱</span>';}, 350);
      setTimeout(()=>{ thinking.querySelector('.bubble').innerHTML = 'Analyzing image… <span aria-hidden="true">▰▰▰▱</span>';}, 700);
      setTimeout(()=>{ thinking.querySelector('.bubble').innerHTML = 'Analyzing image… <span aria-hidden="true">▰▰▰▰</span>';}, 1050);
      setTimeout(()=>{
        thinking.remove();
        addMsg('bot', simulateScan());
      }, 1400);
    });

    // ========== Maps: nearby dermatologists ==========
    $('#findClinics').addEventListener('click', () => {
      if ('geolocation' in navigator){
        navigator.geolocation.getCurrentPosition(pos => {
          const {latitude, longitude} = pos.coords;
          const url = `https://www.google.com/maps/search/dermatologist/@${latitude},${longitude},14z`;
          window.open(url, '_blank', 'noopener');
          addMsg('bot', 'Opened Google Maps with dermatologists near your location.');
        }, () => {
          window.open('https://www.google.com/maps/search/dermatologist', '_blank', 'noopener');
          addMsg('bot', 'Opened Google Maps search for dermatologists (location permission denied).');
        }, {enableHighAccuracy:true, timeout:8000});
      } else {
        window.open('https://www.google.com/maps/search/dermatologist', '_blank', 'noopener');
        addMsg('bot', 'Opened Google Maps search for dermatologists (geolocation not available).');
      }
    });
  </script>
</body>
</html>
